import{a as Q,b as w,c as l,d as m,e as x,f as U,g as q,h as Y,i as E,j as $,k as J,l as Z,m as ee}from"./chunk-A5XPUSZM.js";import{B as K,C as V,D as X,E as N,a as R,b,c as T,d as I,e as S,f as _,g as c,h as g,i as D,j as y,k as B,l as k,m as L,n as G,o as v,p as F,q as z,r as j,x as W}from"./chunk-DGULZJMR.js";import"./chunk-NHXDGK5N.js";import"./chunk-KLDHDQ7H.js";import"./chunk-7XFXJMDA.js";import"./chunk-XUH3WQQT.js";import"./chunk-LV4HBK2W.js";import"./chunk-CLDSZD2A.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-FNBMHXHF.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import"./chunk-JHI3MBHO.js";var ie=["rendererContainer"];function ne(d,s){d&1&&(c(0,"div",6),v(1," \u{1F449} Glisse horizontalement pour d\xE9couvrir ton souhait ! ( droite -----> gauche ) "),g())}var de=(()=>{let s=class s{constructor(){this.animationId=0,this.spine=new l,this.BOOK_WIDTH=2.4,this.BOOK_HEIGHT=1.6,this.PAGE_THICK=.02,this.isOpen=!1,this.showHint=!0,this.targetAngle=0,this.currentAngle=Math.PI/2,this.isPointerDown=!1,this.pointerStartX=0,this.startAngle=0,this.animate=()=>{this.animationId=requestAnimationFrame(this.animate);let e=this.targetAngle-this.currentAngle;this.currentAngle+=e*.15,Math.abs(e)<5e-4&&(this.currentAngle=this.targetAngle),this.applyAngle(this.currentAngle);let t=performance.now()*.002;this.spine.rotation.y=Math.sin(t)*.1,this.spine.rotation.x=Math.sin(t*.6)*.01,this.renderer.render(this.scene,this.camera)},this.onPointerDown=e=>{this.isPointerDown=!0,this.pointerStartX=e.clientX,this.startAngle=this.currentAngle},this.onPointerMove=e=>{if(!this.isPointerDown)return;let t=e.clientX-this.pointerStartX,o=this.rendererContainer.nativeElement.clientWidth||window.innerWidth,r=t/o*Math.PI,i=this.startAngle-r;this.setOpenAngle(i,!1)},this.onPointerUp=e=>{this.isPointerDown&&(this.isPointerDown=!1,this.currentAngle>Math.PI/4?(this.isOpen=!0,this.showHint=!1,this.setOpenAngle(Math.PI/2)):(this.isOpen=!1,this.setOpenAngle(0)))},this.onResize=()=>{let e=this.rendererContainer.nativeElement.clientWidth||window.innerWidth,t=this.rendererContainer.nativeElement.clientHeight||window.innerHeight;this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}}ngAfterViewInit(){this.initScene(),this.loadBookTexturesAndBuild(),this.animate(),window.addEventListener("resize",this.onResize),this.rendererContainer.nativeElement.addEventListener("pointerdown",this.onPointerDown),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp)}ngOnDestroy(){cancelAnimationFrame(this.animationId),window.removeEventListener("resize",this.onResize),this.rendererContainer.nativeElement.removeEventListener("pointerdown",this.onPointerDown),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this.renderer?.dispose()}initScene(){let e=this.rendererContainer.nativeElement.clientWidth||window.innerWidth,t=this.rendererContainer.nativeElement.clientHeight||window.innerHeight;this.scene=new q,this.camera=new U(60,e/t,.1,100),this.camera.position.set(0,-.9,3.5),this.camera.lookAt(0,0,0),this.renderer=new ee({antialias:!0,alpha:!0}),this.renderer.setSize(e,t),this.renderer.setPixelRatio(window.devicePixelRatio||1),this.rendererContainer.nativeElement.appendChild(this.renderer.domElement);let o=new Z(16777215,.6);this.scene.add(o);let r=new J(16777215,.8);r.position.set(5,5,5),this.scene.add(r),this.spine.position.set(0,0,0),this.scene.add(this.spine)}loadBookTexturesAndBuild(){let e=new $,t={coverFront:"assets/image4.jpeg",coverBack:"assets/image3.jpeg",pageLeft:"assets/image2.jpeg",pageRight:"assets/image1.jpeg"};Promise.all([this.loadTextureSafe(e,t.coverFront),this.loadTextureSafe(e,t.coverBack),this.loadTextureSafe(e,t.pageLeft),this.loadTextureSafe(e,t.pageRight)]).then(([o,r,i,n])=>{this.buildBook(o,r,i,n)})}loadTextureSafe(e,t){return new Promise(o=>{e.load(t,r=>{r.anisotropy=4,o(r)},void 0,()=>o(null))})}buildBook(e,t,o,r){let i=this.BOOK_WIDTH/2,n=this.BOOK_HEIGHT,a=this.PAGE_THICK,p=`Bonne Ann\xE9e !
Que tous tes r\xEAves se r\xE9alisent \u{1F31F}`,f=`Avec amour,
Normil Nitshai`,P=this.createMaterialFromImageAndText(o,p),u=this.createMaterialFromImageAndText(r,f),C=e?this.createMaterialFromImageAndText(e,"Carte de V\u0153ux 2025"):new E({color:9109504,side:w}),te=t?this.createMaterialFromImageAndText(t,`De la part de
Normil Nitshai`):new E({color:3355443,side:w}),M=new l;this.rightCoverPivot=new l,this.rightCoverPivot.position.set(0,0,0),M.add(this.rightCoverPivot);let A=new x(i,n,a);this.rightCover=new m(A,C),this.rightCover.position.set(i/2,0,0),this.rightCoverPivot.add(this.rightCover);let H=new x(i-.02,n-.02,a/2);this.rightPage=new m(H,u),this.rightPage.position.set(i/2,0,a+.001),this.rightCoverPivot.add(this.rightPage);let O=new l;this.leftCoverPivot=new l,this.leftCoverPivot.position.set(0,0,0),O.add(this.leftCoverPivot),this.leftCover=new m(A,te),this.leftCover.position.set(-i/2,0,0),this.leftCoverPivot.add(this.leftCover),this.leftPage=new m(H,P),this.leftPage.position.set(-i/2,0,a+.001),this.leftCoverPivot.add(this.leftPage),this.spine.add(M),this.spine.add(O),this.setOpenAngle(2*Math.PI,!1)}setOpenAngle(e,t=!0){this.targetAngle=Math.max(0,Math.min(Math.PI/2,e)),t||(this.currentAngle=this.targetAngle,this.applyAngle(this.currentAngle))}applyAngle(e){!this.rightCoverPivot||!this.leftCoverPivot||(this.rightCoverPivot.rotation.y=-e,this.leftCoverPivot.rotation.y=e)}toggleOpen(){this.isOpen=!this.isOpen,this.showHint=!1,this.setOpenAngle(this.isOpen?Math.PI/2:0)}composeImageAndTextTexture(e,t,o=1024,r=512){let i=document.createElement("canvas");i.width=o,i.height=r;let n=i.getContext("2d");if(e&&(e.image instanceof HTMLImageElement||e.image instanceof ImageBitmap))try{n.drawImage(e.image,0,0,i.width,i.height)}catch{n.fillStyle="#fff8dc",n.fillRect(0,0,i.width,i.height)}else{let h=n.createLinearGradient(0,0,i.width,i.height);h.addColorStop(0,"#fff8dc"),h.addColorStop(1,"#ffe4c4"),n.fillStyle=h,n.fillRect(0,0,i.width,i.height)}n.strokeStyle="rgba(0,0,0,0.06)",n.lineWidth=12,n.strokeRect(10,10,i.width-20,i.height-20),n.fillStyle="#8B0000";let a=t.split(`
`),p=Math.floor(o/30);n.font=`bold ${p}px "Georgia", serif`,n.textAlign="center",n.textBaseline="middle",n.shadowColor="rgba(0,0,0,0.25)",n.shadowOffsetX=3,n.shadowOffsetY=3,n.shadowBlur=6;let f=p*1.2,P=r/2-(a.length-1)*f/2;a.forEach((h,C)=>{n.fillText(h,o/2,P+C*f)});let u=new Y(i);return u.needsUpdate=!0,u}createMaterialFromImageAndText(e,t,o=!0){let r=this.composeImageAndTextTexture(e,t);return new E({map:r,side:o?w:Q,roughness:.7,metalness:.05})}};s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=I({type:s,selectors:[["app-three-book"]],viewQuery:function(t,o){if(t&1&&k(ie,7),t&2){let r;L(r=G())&&(o.rendererContainer=r.first)}},decls:11,vars:2,consts:[["rendererContainer",""],["fullscreen",""],["class","hint",4,"ngIf"],[1,"controls"],["ion-button","",3,"click"],["id","rendererContainer"],[1,"hint"]],template:function(t,o){if(t&1){let r=y();c(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),v(3,"Alexim71 Dev"),g()()(),c(4,"ion-content",1),S(5,ne,2,0,"div",2),c(6,"div",3)(7,"button",4),B("click",function(){return R(r),b(o.toggleOpen())}),v(8),g()(),D(9,"div",5,0),g()}t&2&&(T(5),_("ngIf",o.showHint),T(3),F(o.isOpen?"Fermer":"Ouvrir"))},dependencies:[K,V,X,N,j,z,W],styles:["[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{--background: #111}[_nghost-%COMP%]   #rendererContainer[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;top:0;left:0;touch-action:none}[_nghost-%COMP%]   .controls[_ngcontent-%COMP%]{position:absolute;top:8px;right:12px;z-index:5}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{--background: rgba(255,255,255,.12);color:#fff;border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:6px}[_nghost-%COMP%]   .hint[_ngcontent-%COMP%]{position:absolute;bottom:15%;left:50%;transform:translate(-50%);background:#0009;color:#fff;padding:12px 16px;border-radius:8px;font-size:.95rem;text-align:center;max-width:90%;z-index:10;animation:_ngcontent-%COMP%_pulse 2s infinite}@keyframes _ngcontent-%COMP%_pulse{0%{transform:translate(-50%) scale(1)}50%{transform:translate(-50%) scale(1.05)}to{transform:translate(-50%) scale(1)}}"]});let d=s;return d})();export{de as ThreeBookPage};
